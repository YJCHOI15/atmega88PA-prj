# ATmega88PA 기반 Piano LED Visualizer

## 1. 프로젝트 소개

본 프로젝트는 '2024 CO-SHOW MCU 응용 경진대회' 본선 출품작으로 개발된 피아노 LED 비주얼라이저입니다. 3인 1팀으로 협력하여, 기성품 장난감 피아노의 키보드 회로를 역설계하고 ATmega88PA MCU를 중심으로 제어 시스템을 브레드보드에 직접 구축했습니다.

대회 기간 중에는 1, 2라운드 과제인 건반 입력 실시간 감지, 7-Segment 연동, UART를 통한 MIDI 메시지 전송 기능을 성공적으로 구현했습니다. 최종 3라운드 목표였던 네오픽셀(WS2812B) 제어는 정밀한 타이밍을 맞추는 데 어려움이 있어 완성하지 못했습니다.

하지만 대회 이후에도 포기하지 않고 도전을 계속하여, 결과적으로 WS2812B LED 스트립을 완벽하게 제어하는 데 성공하며 프로젝트를 최종 완성했습니다.

---

## 2. 주요 기능

**대회 기간 내 구현 기능:**

  * **건반 입력 인식:** 장난감 피아노의 키 매트릭스 회로를 분석하여 모든 건반의 Note-On / Note-Off 상태를 실시간으로 감지합니다. 

  * **LED 디스플레이:** 건반 입력에 따라 7-Segment에 해당 건반 번호를 표시합니다. 

  * **MIDI 메시지 전송:** 건반 상태가 변경될 때마다 표준 MIDI 규격에 맞는 메시지를 생성하여 UART 통신으로 PC에 전송합니다. 

**대회 이후 완성 기능:**

  * **네오픽셀 비주얼 이펙트:** SPI 통신을 이용해 WS2812B의 까다로운 타이밍 요구사항(1.25μs±600ns)을 충족시켜, 건반 입력에 실시간으로 반응하는 다채로운 조명 효과를 최종적으로 구현했습니다.

    ![20241122_103337](https://github.com/user-attachments/assets/ad6f18d7-85e7-4e96-9b66-a073e9311038)


---

## 3. 시스템 아키텍처

**하드웨어:**

  * **MCU:** ATmega88PA
  * **Clock:** 16MHz Crystal Oscillator 
  * **입력 장치:** 'CANTO' 장난감 피아노 (분해 후 키 매트릭스 직접 연결)
  * **출력 장치:**
    * 7-Segment LED
    * WS2812B 네오픽셀 LED 스트립 (1m당 60개 LED) 
  * **통신:** USB-MIDI Bridge (UART 신호 변환용)
  * **기타 IC:** 74HC595, 74LS145, 74HC165, SN74HC138 등

**펌웨어:** 

AVR Libc만을 사용하여 C언어로 모든 펌웨어를 직접 작성했으며, 주요 모듈은 다음과 같습니다.

  * **저수준 드라이버:**
    * **usart.c, spi.c:** UART, SPI 통신 프로토콜을 레지스터 레벨에서 직접 제어
    * **timer.c, interrupt.c:** 정밀한 시간 관리 및 이벤트 처리를 위한 타이머/인터럽트 설정
    * 기타 IC 제어 드라이버 (74hc595.c, 74hc165.c, sn74hc138.c 등)
  * **애플리케이션 로직:** 스캔된 키 정보를 바탕으로 디스플레이, MIDI, 네오픽셀 제어 함수를 유기적으로 호출합니다.

--- 

## 4. 팀원 및 역할 분담

본 프로젝트는 3명의 팀원이 다음과 같이 역할을 분담하여 진행했습니다. 다음은 본인이 맡은 역할에 대한 설명입니다. 

  * **펌웨어 아키텍처 설계:** 전체 펌웨어의 구조를 설계하고 각 모듈 간의 인터페이스를 정의했습니다.

  * **저수준 주변기기 드라이버 개발:** ATmega88PA의 모든 주변기기(UART, SPI, Timer 등)를 레지스터 레벨에서 직접 제어하는 드라이버를 작성하여 하드웨어에 대한 깊은 이해도를 보여주었습니다.

  * **통신 프로토콜 구현:** UART를 이용한 MIDI 메시지 송신 프로토콜을 구현했습니다. 특히 대회 기간 중에는 WS2812B의 정밀한 타이밍 제어에 어려움을 겪었으나, 대회 이후 SPI 프로토콜(SPCR 레지스터의 CPHA 비트 설정 등)을 성공적으로 구현하여 최종 기능을 완성하며 기술적 난관에 대한 문제 해결 능력을 입증했습니다.

---

## 5. 동작 시연 사진

![Screenshot_20250919_234529_Gallery](https://github.com/user-attachments/assets/da3cab47-7523-41ac-b3f1-cf0b19e5bcdf)


