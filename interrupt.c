#include "peripherals.h"

// 인터럽트 초기화 함수
void Interrupt_Init(void) {
    // 1. 타이머 인터럽트 설정 (Timer0, CTC 모드)
    // - 타이머0을 CTC 모드로 설정하여 일정 주기마다 인터럽트 발생
    // - 타이머0의 비교 레지스터 값 (OCR0A) 설정
    // - 타이머0 인터럽트 활성화 (TIMER0_COMPA_vect)

    // 타이머0을 CTC 모드로 설정 (비교 일치 모드)
    TCCR0A = 0;              // WGM01, WGM00을 0으로 설정 (CTC 모드)
    TCCR0B = (1 << WGM02)    // WGM02를 1로 설정
             | (1 << CS02)   // 프리스케일러 256 설정
             | (1 << CS00);  // 타이머 클럭 분주기 256
    OCR0A = 255;             // 256분주기로 설정하여 인터럽트 주기를 약 1초로 설정

    // 타이머0 비교 일치 인터럽트 활성화
    TIMSK0 |= (1 << OCIE0A); // TIMER0_COMPA_vect 인터럽트 활성화

    // 2. 외부 인터럽트 설정 (INT0)
    // - INT0은 외부 인터럽트 0 핀을 사용하여 인터럽트 발생
    // - 낮은 신호 레벨에서 인터럽트 발생
    EICRA = (1 << ISC01);    // INT0을 낮은 엣지에서 트리거
    EIMSK |= (1 << INT0);    // INT0 인터럽트 활성화

    // 전역 인터럽트 활성화
    sei();  // 전역 인터럽트 허용
}

// 타이머0 인터럽트 핸들러
ISR(TIMER0_COMPA_vect) {
    // 타이머0 비교 일치 인터럽트 발생 시 처리할 코드
    // 예: LED 토글
    PORTB ^= (1 << PORTB0);  // PORTB0 핀의 상태를 반전시킴 (LED 토글)
}

// 외부 인터럽트0 핸들러 (INT0)
ISR(INT0_vect) {
    // 외부 인터럽트0 발생 시 처리할 코드
    // 예: 버튼 눌림 시 LED 토글
    PORTB ^= (1 << PORTB1);  // PORTB1 핀의 상태를 반전시킴 (LED 토글)
}

